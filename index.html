<html>

<head>
    <title></title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" /> </head>

<body>
    <div class="container">
        <div class="form-group">
            <button class="btn btn-default" type="button" id="ShowCreateFormButton">打開新增資料頁面</button>
        </div>
        <div class="form-group">
            <button class="btn btn-default" type="button" id="HideCreateFormButton">隱藏新增資料頁面</button>
        </div>
        <form id="CreateForm" hidden>
            <div class="form-group">
                <label for="title">title</label>
                <input type="text" class="form-control" id="title" placeholder="title">
            </div>
            <div class="form-group">
                <label for="author">author</label>
                <input type="text" class="form-control" id="author" placeholder="author">
            </div>
            <div class="form-group">
                <label for="phone">phone</label>
                <input type="text" class="form-control" id="phone" placeholder="phone">
            </div>
            <div class="form-group">
                <label for="mobilephone">mobilephone</label>
                <input type="text" class="form-control" id="mobilephone" placeholder="mobilephone">
            </div>
            <div class="form-group">
                <label for="address">address</label>
                <input type="text" class="form-control" id="address" placeholder="address">
            </div>
            <button type="button" class="btn btn-default" id="CreateData">新增資料</button>
        </form>
        <div class="table-responsive">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th></th>
                        <th>title</th>
                        <th>author</th>
                        <th>phone</th>
                        <th>mobilephone</th>
                        <th>address</th>
                    </tr>
                </thead>
                <tbody id="PostsTable">

                </tbody>
            </table>
        </div>
    </div>
</body>
<script src="js/jquery-3.2.1.min.js"></script>

<script src="js/bootstrap.min.js"></script>
<script>
    $(function () {

        $("#ShowCreateFormButton").click(function () {
            $("#CreateForm").show()
        })
        $("#HideCreateFormButton").click(function () {
            $("#CreateForm").hide()
        })
        $("#CreateData").click(function () {
            var CreateDataJson = {
                title: $("#title").val(),
                author: $("#author").val(),
                phone: $("#phone").val(),
                mobilephone: $("#mobilephone").val(),
                address: $("#address").val(),
            }
            $.ajax({
                //web api網址
                url: "http://localhost:3000/posts",
                //Web Request類型
                type: 'Post',
                //回傳內容類型
                contentType: "application/json; charset=utf-8",
                //回傳資料型別
                datatype: 'json',
                //回傳給web api的資料
                data: JSON.stringify(CreateDataJson),
                //當ajax發生錯誤會觸發此程式
                error: function (xhr) {
                    console.log(xhr);
                },
                //當ajax執行成功會觸發此程式
                success: function (result) {
                    GetPostsData()
                },
            });
        })

        GetPostsData();

        function GetPostsData() {
            $.ajax({
                //web api網址
                url: "http://localhost:3000/posts",
                //Web Request類型
                type: 'Get',
                //回傳內容類型
                contentType: "application/json; charset=utf-8",
                //回傳資料型別
                datatype: 'json',
                //回傳給web api的資料
                //data:JSON.stringify(AddData) ,
                //當ajax發生錯誤會觸發此程式
                error: function (xhr) {
                    console.log(xhr);
                },
                //當ajax執行成功會觸發此程式
                success: function (result) {
                    $("#PostsTable").empty()
                    $.each(result, function (i, o) {
                        $("#PostsTable").append(
                            "<tr" + " id=" + o.id + ">" +
                            "<td>" +
                            "<button class='btn btn-success Edit' type='button'>Edit</button>" +
                            "<button class='btn btn-danger Delete' type='button'>Delete</button>" +
                            "<button class='btn btn-info Detail' type='button'>Detail</button>" +
                            "</td>" +
                            "<td>" + o.title + "</td>" +
                            "<td>" + o.autor + "</td>" +
                            "<td>" + o.phone + "</td>" +
                            "<td>" + o.mobilephone + "</td>" +
                            "<td>" + o.address + "</td>" +
                            "</tr>")
                    })
                    $(".Edit").click(function () {
                        console.log($(this).parents()[1].id)
                    })
                    $(".Delete").click(function () {
                        console.log($(this).parents()[1].id)
                    })
                    $(".Detail").click(function () {
                        console.log($(this).parents()[1].id)
                    })

                    console.log(result);
                },
            });
        }
    })
</script>

</html>